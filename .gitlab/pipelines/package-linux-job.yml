package-linux:
  stage: package
  image: mcr.microsoft.com/dotnet/sdk:8.0.203-jammy # https://hub.docker.com/_/microsoft-dotnet-sdk
  tags:
  - Kubernetes-PWSH
  rules:
  - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
    when: on_success
  - if: '$CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH'
    when: manual
    allow_failure: true
  dependencies: []
  needs: []
  artifacts:
    when: always
    paths:
    - '_Artifacts/**/*'
  script:
  - |
    # Activate backward compatibility.
    $PSNativeCommandArgumentPassing = 'Legacy'

    Write-Host "> Creating executable for linux ..."

    & build/CreateRelease.ps1 -CreateGlobalTool $false -CreateNugetPackage $false -CreateExecutables $true -Configuration $Q_Configuration -ReleaseRootDirectoryPath $ArtifactsDirectoryPath -Runtime "linux-x64" -Verbosity $Q_Verbosity

    if ($LastExitCode -ne 0) {
      throw "Packaging Failed"
    }
